<!DOCTYPE html><html lang="en"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.0.5/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="jiancheng_wang"><meta name="copyright" content="jiancheng_wang"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>electron-vue | 猫九大大のBlog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.21/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="shortcut icon" type="image/svg+xml" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"jianchengwang.info","root":"/","title":["猫","九","大","大","の","Blog"],"version":"1.2.0","mode":"auto","copycode":true,"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><script src="https://cdn.jsdelivr.net/gh/jianchengwang/live2d_models@main/assets/js/live2dv3.init.js"></script><meta name="description" content="最近喵到一个开源项目 PicGo ，感觉还不错，顺便翻了下大佬的博客，发现有个实战系列Electron-vue开发实战，于是趁机搞个Todo练练手，学习一波Electron-vue，以下大部分代码来自大佬的博客，所以感兴趣的去看下大佬的博客吧，我只是搬运工小弟。感觉如果有开发过java swing或其他gui的应该都大同小异。">
<meta property="og:type" content="article">
<meta property="og:title" content="electron-vue">
<meta property="og:url" content="https://jianchengwang.info/2020/10/27/web/vue/electron-vue/index.html">
<meta property="og:site_name" content="猫九大大のBlog">
<meta property="og:description" content="最近喵到一个开源项目 PicGo ，感觉还不错，顺便翻了下大佬的博客，发现有个实战系列Electron-vue开发实战，于是趁机搞个Todo练练手，学习一波Electron-vue，以下大部分代码来自大佬的博客，所以感兴趣的去看下大佬的博客吧，我只是搬运工小弟。感觉如果有开发过java swing或其他gui的应该都大同小异。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://blog.res.jianchengwang.info/electron-vue/main_renderer.png">
<meta property="article:published_time" content="2020-10-27T08:22:06.605Z">
<meta property="article:modified_time" content="2020-10-27T08:22:06.605Z">
<meta property="article:author" content="jiancheng_wang">
<meta property="article:tag" content="electron">
<meta property="article:tag" content="vue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://blog.res.jianchengwang.info/electron-vue/main_renderer.png"><script src="/js/ui/mode.js"></script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="jiancheng_wang"><img width="96" loading="lazy" src="https://blog.res.jianchengwang.info/avatar.jpg" alt="jiancheng_wang"><span class="site-author-status" title="balabala....">😊</span></a><div class="site-author-name"><a href="/about/">jiancheng_wang</a></div><a class="site-name" href="/about/site.html">猫九大大のBlog</a><sub class="site-subtitle">Have fun and enjoy every day</sub><div class="site-desciption">balabala...</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">30</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">29</span></a></div><a class="site-state-item hty-icon-button" href="/albums" title="Albums"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-gallery-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/jianchengwang" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:jianchengwang80@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/wjc750145113" title="Weibo" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://files.jianchengwang.info/" title="Files" target="_blank" style="color:blue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.now.sh/" title="Travelling" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-send-plane-2-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="Friend Links" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="Lovely Girls" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Main-amp-Renderer"><span class="toc-number">2.</span> <span class="toc-text">Main &amp; Renderer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Main%E8%BF%9B%E7%A8%8B%E5%BC%80%E5%8F%91"><span class="toc-number">2.1.</span> <span class="toc-text">Main进程开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#app"><span class="toc-number">2.1.1.</span> <span class="toc-text">app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Browser-Window"><span class="toc-number">2.1.2.</span> <span class="toc-text">Browser Window</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tray"><span class="toc-number">2.1.3.</span> <span class="toc-text">Tray</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">鼠标左键点击事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E5%8F%B3%E9%94%AE%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">鼠标右键点击事件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Menu"><span class="toc-number">2.1.4.</span> <span class="toc-text">Menu</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Renderer%E8%BF%9B%E7%A8%8B%E5%BC%80%E5%8F%91"><span class="toc-number">2.2.</span> <span class="toc-text">Renderer进程开发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Hash%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.1.</span> <span class="toc-text">使用Hash模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0titlebar"><span class="toc-number">2.2.2.</span> <span class="toc-text">实现titlebar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#drag-amp-drop-%E7%9A%84%E9%81%BF%E5%85%8D"><span class="toc-number">2.2.3.</span> <span class="toc-text">drag &amp; drop 的避免</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#remote%E6%A8%A1%E5%9D%97%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.4.</span> <span class="toc-text">remote模块的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#shell"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">shell</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dialog"><span class="toc-number">2.2.4.2.</span> <span class="toc-text">dialog</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Menu-amp-Browser-Window%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">2.2.5.</span> <span class="toc-text">Menu &amp; Browser-Window的应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Main-amp-Renderer%E9%80%9A%E4%BF%A1"><span class="toc-number">2.2.6.</span> <span class="toc-text">Main &amp; Renderer通信</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ipcMain-amp-ipcRenderer"><span class="toc-number">2.2.6.1.</span> <span class="toc-text">ipcMain &amp; ipcRenderer</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webContents"><span class="toc-number">2.2.6.2.</span> <span class="toc-text">webContents</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://jianchengwang.info/2020/10/27/web/vue/electron-vue/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="jiancheng_wang"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="猫九大大のBlog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">electron-vue<a class="post-edit-link" href="https://github.com/jianchengwang/jianchengwang.github.io/tree/hexo/source/_posts/web/vue/electron-vue.md" target="_blank" title="Edit this post" rel="noopener"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-edit-line"></use></svg></a></h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2020-10-27 16:22:06" itemprop="dateCreated datePublished" datetime="2020-10-27T16:22:06+08:00">2020-10-27</time></div><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/web/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">web</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category" href="/categories/web/vue/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">vue</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag" href="/tags/electron/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">electron</span></a><a class="tag" href="/tags/vue/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">vue</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><p>最近喵到一个开源项目 <a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo">PicGo</a> ，感觉还不错，顺便翻了下大佬的博客，发现有个实战系列<a href="%5Bhttps://molunerfinn.com/electron-vue-1/#%E5%89%8D%E8%A8%80%5D(https://molunerfinn.com/electron-vue-1/#%E5%89%8D%E8%A8%80)">Electron-vue开发实战</a>，于是趁机搞个<code>Todo</code>练练手，学习一波<a target="_blank" rel="noopener" href="https://github.com/SimulatedGREG/electron-vue">Electron-vue</a>，以下大部分代码来自大佬的博客，所以感兴趣的去看下大佬的博客吧，我只是搬运工小弟。感觉如果有开发过<code>java swing</code>或其他<code>gui</code>的应该都大同小异。</p>
<a id="more"></a>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre class="language-none"><code class="language-none"># 全局安装vue-cli
npm install -g vue-cli
# 然后使用vue-cli来安装electron-vue的模板
vue init simulatedgreg&#x2F;electron-vue electron-vue-storage
# 安装依赖
cd electron-vue-storage
yarn
# 进入开发模式
yarn run dev</code></pre>

<p>大概有一个粗略的认识。<code>electron</code>的开发其实包括了两个部分，一个是<code>main</code>进程的相关开发，一个是<code>renderer</code>进程的相关开发。对于<code>renderer</code>进程的开发对于大多数前端开发人员来说不难。<code>main</code>进程的相关开发，从需求出发，从工程本身的需要出发，那么只需要用到的时候再去学习即可。不过要对<code>Node.js</code>能做到的事有个概念——它并不是万能的。</p>
<h2 id="Main-amp-Renderer"><a href="#Main-amp-Renderer" class="headerlink" title="Main &amp; Renderer"></a>Main &amp; Renderer</h2><p>简单来说，<code>Main</code> 进程管理的是我们看到的这个<code>app窗口</code>(<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/api/browser-window">browser-window</a>) ，<code>Renderer</code> 进程对应的就是我们属性的界面的<code>UI渲染</code> 。不过实际上，当然不仅如此，下面一张图能够把它们所支持、管理的<code>electron</code>或者原生的模块大致列出来：</p>
<p><img src="http://blog.res.jianchengwang.info/electron-vue/main_renderer.png" alt="Main&amp;Renderer process tree" loading="lazy"></p>
<h3 id="Main进程开发"><a href="#Main进程开发" class="headerlink" title="Main进程开发"></a>Main进程开发</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> app<span class="token punctuation">,</span> BrowserWindow <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'electron'</span> <span class="token comment">// 从electron引入app和BrowserWindow</span>

<span class="token keyword">let</span> mainWindow

<span class="token keyword">const</span> winURL <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>
  <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:9080</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// 开发模式的话走webpack-dev-server的url</span>
  <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">file://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>__dirname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">function</span> <span class="token function">createWindow</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 创建窗口</span>
  <span class="token comment">/**
   * Initial window options
   */</span>
  mainWindow <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    height<span class="token operator">:</span> <span class="token number">563</span><span class="token punctuation">,</span>
    useContentSize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    width<span class="token operator">:</span> <span class="token number">1000</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个窗口</span>

  mainWindow<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>winURL<span class="token punctuation">)</span> <span class="token comment">// 加载窗口的URL -> 来自renderer进程的页面</span>

  mainWindow<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    mainWindow <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> createWindow<span class="token punctuation">)</span> <span class="token comment">// app准备好的时候创建窗口</span></code></pre>

<p>暂且先不管渲染进程里的页面长什么样，在<code>app</code>准备好的时候打开一个窗口只需要调用一个创建<code>BrowserWindow</code>的方法即可。</p>
<p><code>Main进程</code>里的开发有点当年写<code>jQuery</code>的样子，比较多的是<code>事件驱动型</code>的写法。</p>
<h4 id="app"><a href="#app" class="headerlink" title="app"></a>app</h4><p>首先需要注意的是<a target="_blank" rel="noopener" href="https://electronjs.org/docs/api/app">app</a>的模块。这个模块是electron应用的骨架。它掌管着整个应用的生命周期钩子，以及很多其他事件钩子。</p>
<p>app的常用生命周期钩子如下：</p>
<ul>
<li><code>will-finish-launching</code> 在应用完成基本启动进程之后触发</li>
<li><code>ready</code> 当electron完成初始化后触发</li>
<li><code>window-all-closed</code> 所有窗口都关闭的时候触发，在windows和linux里，所有窗口都退出的时候<strong>通常</strong>是应用退出的时候</li>
<li><code>before-quit</code> 退出应用之前的时候触发</li>
<li><code>will-quit</code> 即将退出应用的时候触发</li>
<li><code>quit</code> 应用退出的时候触发</li>
</ul>
<p>而我们通常会在<code>ready</code>的时候执行创建应用窗口、创建应用菜单、创建应用快捷键等初始化操作。而在<code>will-quit</code>或者<code>quit</code>的时候执行一些清空操作，比如解绑应用快捷键。</p>
<p>特别的，在非<code>macOS</code>的系统下，通常一个应用的所有窗口都退出的时候，也是这个应用退出之时。所以可以配合<code>window-all-closed</code>这个钩子来实现。</p>
<p>这个需要用到哪些钩子函数，喵下官网文档吧，都差不多的东东，这里不多叙述。</p>
<h4 id="Browser-Window"><a href="#Browser-Window" class="headerlink" title="Browser Window"></a>Browser Window</h4><p>下面我们来看看创建一个BrowserWindow的常用配置：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> window

<span class="token keyword">function</span> <span class="token function">createWindow</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  window <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    height<span class="token operator">:</span> <span class="token number">900</span><span class="token punctuation">,</span> <span class="token comment">// 高</span>
    width<span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token comment">// 宽</span>
    show<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 创建后是否显示</span>
    frame<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否创建frameless窗口</span>
    fullscreenable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许全屏</span>
    center<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否出现在屏幕居中的位置</span>
    backgroundColor<span class="token operator">:</span> <span class="token string">'#fff'</span> <span class="token comment">// 背景色，用于transparent和frameless窗口</span>
    titleBarStyle<span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token comment">// 标题栏的样式，有hidden、hiddenInset、customButtonsOnHover等</span>
    resizable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许拉伸大小</span>
    transparent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否是透明窗口（仅macOS）</span>
    vibrancy<span class="token operator">:</span> <span class="token string">'ultra-dark'</span><span class="token punctuation">,</span> <span class="token comment">// 窗口模糊的样式（仅macOS）</span>
    webPreferences<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      backgroundThrottling<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 当页面被置于非激活窗口的时候是否停止动画和计时器</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ... 以及其他可选配置</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  window<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>

  window<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'closed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> window <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>同<code>app</code> 一样，也有很多钩子函数，这里也是直接跳过。</p>
<h4 id="Tray"><a href="#Tray" class="headerlink" title="Tray"></a>Tray</h4><p>简单来说，就是不同系统任务栏里的图标组件了。</p>
<p>需要注意的是，<code>windows</code>和<code>macOS</code>里，图标的大小都是<code>16*16</code>px。<code>macOS</code>下顶部栏的图标通常都是走<code>黑白</code>路线，所以可以为两种系统分别准备不同的图标。<code>Tray</code> 生成代码</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">createTray</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> menubarPic <span class="token operator">=</span> process<span class="token punctuation">.</span>platform <span class="token operator">===</span> <span class="token string">'darwin'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>__static<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/menubar.png</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>__static<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/menubar-nodarwin.png</span><span class="token template-punctuation string">`</span></span>
  tray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span>menubarPic<span class="token punctuation">)</span>
  <span class="token keyword">const</span> contextMenu <span class="token operator">=</span> <span class="token comment">// ...菜单</span>
  tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'right-click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 右键点击</span>
    window<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 隐藏小窗口</span>
    tray<span class="token punctuation">.</span><span class="token function">popUpContextMenu</span><span class="token punctuation">(</span>contextMenu<span class="token punctuation">)</span> <span class="token comment">// 打开菜单</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 左键点击</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">===</span> <span class="token string">'darwin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果是macOS</span>
      <span class="token function">toggleWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 打开或关闭小窗口</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果是windows</span>
      window<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 隐藏小窗口</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>settingWindow <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果主窗口不存在就创建一个</span>
        <span class="token function">createSettingWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        settingWindow<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 如果主窗口在，就显示并激活</span>
        settingWindow<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        settingWindow<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>注意上述代码里有一个<code>$&#123;__static&#125;</code>的变量。该变量是<code>electron-vue</code>为我们暴露出来的项目根目录下的<code>static</code>文件夹的路径。通过这个路径，在开发和生产阶段都能很好的定位你的静态资源所在的目录。是个很方便的变量。</p>
<p>当然<code>Tray</code>并不只是一个图标而无其他作用了。Tray支持很多有用的事件。其中最关键的两个是<code>click</code>和<code>right-click</code>。分别对应鼠标左键点击和鼠标右键点击事件。</p>
<h5 id="鼠标左键点击事件"><a href="#鼠标左键点击事件" class="headerlink" title="鼠标左键点击事件"></a>鼠标左键点击事件</h5><ul>
<li>在<code>macOS</code>系统下，鼠标左键点击<code>Tray</code>的<code>icon</code>可能会出现配置菜单，也有可能会出现应用窗口。</li>
<li>在<code>windows</code>下，鼠标左键点击<code>Tray</code>的<code>icon</code>通常会出现应用的窗口。</li>
</ul>
<h5 id="鼠标右键点击事件"><a href="#鼠标右键点击事件" class="headerlink" title="鼠标右键点击事件"></a>鼠标右键点击事件</h5><ul>
<li><p>在<code>macOS</code>系统下，鼠标右键点击<code>Tray</code>的<code>icon</code>通常会出现配置菜单。</p>
</li>
<li><p>在<code>windows</code>系统下，同上。</p>
<p>所以一般自己根据需要写监听事件。</p>
</li>
</ul>
<h4 id="Menu"><a href="#Menu" class="headerlink" title="Menu"></a>Menu</h4><p><code>electron</code>威力强大的<code>Menu</code>组件，既能够生成系统菜单项，也能实现绑定应用常用快捷键的功能。</p>
<p>主要分两种。</p>
<ul>
<li>第一种是<code>app的菜单</code>。对于macOS来说就是顶部栏左侧区域的菜单项。对于windows而言就是一个窗口的标题栏下方的菜单区。</li>
<li>第二种是类似于<code>右键菜单</code>的菜单。</li>
</ul>
<p>第一种菜单可以通过<code>Menu.setApplicationMenu()</code>来实现。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">createMenu</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'development'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
      label<span class="token operator">:</span> <span class="token string">'Edit'</span><span class="token punctuation">,</span>
      submenu<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span> label<span class="token operator">:</span> <span class="token string">'Undo'</span><span class="token punctuation">,</span> accelerator<span class="token operator">:</span> <span class="token string">'CmdOrCtrl+Z'</span><span class="token punctuation">,</span> selector<span class="token operator">:</span> <span class="token string">'undo:'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> label<span class="token operator">:</span> <span class="token string">'Redo'</span><span class="token punctuation">,</span> accelerator<span class="token operator">:</span> <span class="token string">'Shift+CmdOrCtrl+Z'</span><span class="token punctuation">,</span> selector<span class="token operator">:</span> <span class="token string">'redo:'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'separator'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> label<span class="token operator">:</span> <span class="token string">'Cut'</span><span class="token punctuation">,</span> accelerator<span class="token operator">:</span> <span class="token string">'CmdOrCtrl+X'</span><span class="token punctuation">,</span> selector<span class="token operator">:</span> <span class="token string">'cut:'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> label<span class="token operator">:</span> <span class="token string">'Copy'</span><span class="token punctuation">,</span> accelerator<span class="token operator">:</span> <span class="token string">'CmdOrCtrl+C'</span><span class="token punctuation">,</span> selector<span class="token operator">:</span> <span class="token string">'copy:'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> label<span class="token operator">:</span> <span class="token string">'Paste'</span><span class="token punctuation">,</span> accelerator<span class="token operator">:</span> <span class="token string">'CmdOrCtrl+V'</span><span class="token punctuation">,</span> selector<span class="token operator">:</span> <span class="token string">'paste:'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span> label<span class="token operator">:</span> <span class="token string">'Select All'</span><span class="token punctuation">,</span> accelerator<span class="token operator">:</span> <span class="token string">'CmdOrCtrl+A'</span><span class="token punctuation">,</span> selector<span class="token operator">:</span> <span class="token string">'selectAll:'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          label<span class="token operator">:</span> <span class="token string">'Quit'</span><span class="token punctuation">,</span>
          accelerator<span class="token operator">:</span> <span class="token string">'CmdOrCtrl+Q'</span><span class="token punctuation">,</span>
          <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
    menu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
    Menu<span class="token punctuation">.</span><span class="token function">setApplicationMenu</span><span class="token punctuation">(</span>menu<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>第二种菜单可以通过两个步骤来展示：</p>
<p><strong>1.</strong> 创建菜单：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> contextMenu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<p><strong>2.</strong> 展示菜单：</p>
<pre class="language-js" data-language="js"><code class="language-js">tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'right-click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token comment">// 右键点击tray的时候  tray.popUpContextMenu(contextMenu) // 弹出菜单&#125;)</span></code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> contextMenu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">&#123;</span>
     label<span class="token operator">:</span> <span class="token string">'关于'</span><span class="token punctuation">,</span>
     <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       dialog<span class="token punctuation">.</span><span class="token function">showMessageBox</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
         title<span class="token operator">:</span> <span class="token string">'PicGo'</span><span class="token punctuation">,</span>
         message<span class="token operator">:</span> <span class="token string">'PicGo'</span><span class="token punctuation">,</span>
         detail<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Version: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pkg<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">\nAuthor: Molunerfinn\nGithub: https://github.com/Molunerfinn/PicGo</span><span class="token template-punctuation string">`</span></span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#123;</span>
     label<span class="token operator">:</span> <span class="token string">'打开详细窗口'</span><span class="token punctuation">,</span>
     <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>settingWindow <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         <span class="token function">createSettingWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         settingWindow<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
         settingWindow<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         settingWindow<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">&#125;</span>
     <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#123;</span>
     label<span class="token operator">:</span> <span class="token string">'选择默认图床'</span><span class="token punctuation">,</span>
     type<span class="token operator">:</span> <span class="token string">'submenu'</span><span class="token punctuation">,</span>
     submenu<span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token punctuation">&#123;</span>
         label<span class="token operator">:</span> <span class="token string">'微博图床'</span><span class="token punctuation">,</span>
         type<span class="token operator">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span>
         checked<span class="token operator">:</span> db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'weibo'</span><span class="token punctuation">,</span>
         <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">,</span> <span class="token string">'weibo'</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
       <span class="token punctuation">&#123;</span>
         label<span class="token operator">:</span> <span class="token string">'七牛图床'</span><span class="token punctuation">,</span>
         type<span class="token operator">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span>
         checked<span class="token operator">:</span> db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'qiniu'</span><span class="token punctuation">,</span>
         <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">,</span> <span class="token string">'qiniu'</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
       <span class="token punctuation">&#123;</span>
         label<span class="token operator">:</span> <span class="token string">'腾讯云COS'</span><span class="token punctuation">,</span>
         type<span class="token operator">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span>
         checked<span class="token operator">:</span> db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'tcyun'</span><span class="token punctuation">,</span>
         <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">,</span> <span class="token string">'tcyun'</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
       <span class="token punctuation">&#123;</span>
         label<span class="token operator">:</span> <span class="token string">'又拍云图床'</span><span class="token punctuation">,</span>
         type<span class="token operator">:</span> <span class="token string">'radio'</span><span class="token punctuation">,</span>
         checked<span class="token operator">:</span> db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'upyun'</span><span class="token punctuation">,</span>
         <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'picBed.current'</span><span class="token punctuation">,</span> <span class="token string">'upyun'</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span>
     <span class="token punctuation">]</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#123;</span>
     label<span class="token operator">:</span> <span class="token string">'打开更新助手'</span><span class="token punctuation">,</span>
     type<span class="token operator">:</span> <span class="token string">'checkbox'</span><span class="token punctuation">,</span>
     checked<span class="token operator">:</span> db<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'picBed.showUpdateTip'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token function">click</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">const</span> value <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'picBed.showUpdateTip'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       db<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'picBed.showUpdateTip'</span><span class="token punctuation">,</span> <span class="token operator">!</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">&#125;</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#123;</span>
     role<span class="token operator">:</span> <span class="token string">'quit'</span><span class="token punctuation">,</span>
     label<span class="token operator">:</span> <span class="token string">'退出'</span>
   <span class="token punctuation">&#125;</span>
 <span class="token punctuation">]</span><span class="token punctuation">)</span>

 tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'right-click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
   tray<span class="token punctuation">.</span><span class="token function">popUpContextMenu</span><span class="token punctuation">(</span>contextMenu<span class="token punctuation">)</span>
 <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p>基本上有了上述的几个基本模块，我们的一个应用的骨架是基本搭建好了，拥有窗口、任务栏应用图标和菜单项。其他的Main进程的模块，并不是必须的，当会用到的时候将在之后的文章里逐步提及。下面我们将来看<code>renderer进程</code>的开发。</p>
<h3 id="Renderer进程开发"><a href="#Renderer进程开发" class="headerlink" title="Renderer进程开发"></a>Renderer进程开发</h3><p>对于<code>electron-vue</code>而言，renderer进程其实大部分就是在写我们平时常写的前端页面罢了。不过相对于平时在浏览器里写的页面，在electron里写页面的时候你还能用到不少非浏览器端的模块，比如<code>fs</code>，比如<code>electron</code>通过<code>remote</code>模块暴露给<code>renderer</code>进程的模块。接下去我们来看看<code>renderer</code>进程有哪些需要注意的地方。</p>
<h4 id="使用Hash模式"><a href="#使用Hash模式" class="headerlink" title="使用Hash模式"></a>使用Hash模式</h4><p>往常我们在写Vue的时候都比较喜欢开启路由的<code>history</code>模式，因为这样在浏览器的地址栏上看起来比较好看——没有hash的<code>#</code>号，就如同请求后端的url一般。然而需要注意的是，<code>history</code>模式需要后端服务器的支持。</p>
<p>可能很多朋友平时开发的时候没有感觉，那是因为vue-cli里在开发模式下启动的<code>webpack-dev-server</code>帮你实现了服务端的<code>history-fallback</code>的特性。所以在实际部署的时候，至少都需要在你的web服务器程序诸如<code>nginx</code>、<code>apache</code>等配置相关的规则，让前端路由返回给<code>vue-router</code>去处理。</p>
<p>而electron里也是如此。在开发模式下，由于使用的是<code>webpack-dev-server</code>开启的服务器，所以<code>BrowserWindow</code>加载的是来自于类似<code>http://localhost:9080</code>这样的地址的页面。而在生产模式下，却是使用的<code>file://</code>的协议，比如<code>file://$&#123;__dirname&#125;/index.html</code>来指定窗口加载的页面。</p>
<p>因此，从上面的表述你也能明白了。假如我有一个子路由地址为<code>child</code>。如果不启用Hash模式，在开发模式下没啥问题，<code>http://localhost:9080/child</code>，但是在生产模式下，<code>file://$&#123;__dirname&#125;/index.html/child</code>却是无法匹配的一条路径。因此在electron下，<code>vue-router</code>请不要使用<code>history</code>模式，而使用默认的<code>hash</code>模式。</p>
<p>那么上面的问题就迎刃而解，变为<code>file://$&#123;__dirname&#125;/index.html#child</code>即可。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> winURL <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>
  <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:9080</span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">file://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>__dirname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">const</span> settingWinURL <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'development'</span>
  <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:9080/#setting/upload</span><span class="token template-punctuation string">`</span></span>
  <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">file://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>__dirname<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/index.html#setting/upload</span><span class="token template-punctuation string">`</span></span></code></pre>

<h4 id="实现titlebar"><a href="#实现titlebar" class="headerlink" title="实现titlebar"></a>实现titlebar</h4><p>在上面讲<code>BrowserWindow</code>的时候，我说到有时为了应用的美观，并不想让我们的应用窗口采用系统默认的<code>titlebar</code>，而想用自己写的来实现。这样的话就在创建你的<code>BrowserWindow</code>的配置里加上一句</p>
<pre class="language-js" data-language="js"><code class="language-js">titleBarStyle<span class="token operator">:</span> <span class="token string">'hidden'</span></code></pre>

<p>这样就行了。然后你就可以自行在renderer进程的页面里模拟一个顶部的<code>titlebar</code>了，比如上面提到的<code>PicGo</code>的<code>titlebar</code>的样子。实际上代码也很简单：</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fake-title-bar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  
    PicGo - &#123;&#123; version &#125;&#125;  
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handle-bar<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>os === <span class="token punctuation">'</span>win32<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 
        <span class="token comment">&lt;!-- 如果是windows系统 就加上模拟的操作按钮--></span>    
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-minus<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minimizeWindow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>    
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>el-icon-close<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>closeWindow<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span> 
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>

<p>然后把这个<code>titlebar</code>的<code>position</code>置顶即可。</p>
<p>不过在平时的使用中，我们要注意，一般我们鼠标按住<code>titleba</code>r的时候是可以拖动窗口的。但是如果我们在不加可拖拽的属性之前，我们自己写的<code>titlebar</code>是不具备这样的特性的。要加上这个特性也很简单：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.fake-title-bar</span> <span class="token punctuation">&#123;</span>  -webkit-app-region drag<span class="token punctuation">&#125;</span></code></pre>

<p>只需一条CSS，即可让你的titlebar可以拖拽。</p>
<p>不过在windows下，操作区的按钮（缩小、放大、关闭）长按应该是不能拖拽的，所以还需要：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.handle-bar</span> <span class="token punctuation">&#123;</span>  -webkit-app-region no-drag<span class="token punctuation">&#125;</span></code></pre>

<p>变成<code>no-drag</code>，这样就实现了我们自己生成应用的<code>titlebar</code>了。</p>
<h4 id="drag-amp-drop-的避免"><a href="#drag-amp-drop-的避免" class="headerlink" title="drag &amp; drop 的避免"></a>drag &amp; drop 的避免</h4><p>通常我们用<code>Chrome</code>的时候，有个特性是比如你往<code>Chrome</code>里拖入一个<code>pdf</code>，它就会自动用<code>内置的pdf阅读器</code>打开。你往<code>Chrome</code>里拖入一张图片，它就会打开这张图片。由于我们的<code>electron</code>应用的<code>BrowserWindow</code>其实内部也是一个浏览器，所以这样的特性依然存在。而这也是很多人没有注意的地方。也就是当你开发完一个<code>electron</code>应用之后，往里拖入一张图片，一个<code>pdf</code>等等，如果不是一个可拖拽区域，那么它就不应该打开这张图、这个<code>pdf</code>，而是将其排除在外。</p>
<p>所以我们将在全局监听<code>drag</code>和<code>drop</code>事件，当用户拖入一个文件但是又不是拖入可拖拽区域的时候，应该将其屏蔽掉。因为所有的页面都应该要有这样的特性，所以我写了一个<code>vue</code>的<code>mixin</code>：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">disableDragEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">disableDragEvent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragenter'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableDrag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragover'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableDrag<span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableDrag<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">disableDrag</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> dropzone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'upload-area'</span><span class="token punctuation">)</span> <span class="token comment">// 这个是可拖拽的上传区</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>dropzone <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>dropzone<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>effectAllowed <span class="token operator">=</span> <span class="token string">'none'</span>
        e<span class="token punctuation">.</span>dataTransfer<span class="token punctuation">.</span>dropEffect <span class="token operator">=</span> <span class="token string">'none'</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">beforeDestroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'dragenter'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableDrag<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'dragover'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableDrag<span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>disableDrag<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>这样在全局引入这个<code>mixin</code>即可。</p>
<h4 id="remote模块的使用"><a href="#remote模块的使用" class="headerlink" title="remote模块的使用"></a>remote模块的使用</h4><p><code>remote</code>模块是<code>electron</code>为了让一些原本在<code>Main</code>进程里运行的模块也能在<code>renderer</code>进程里运行而创建的。以下说几个我们会用到的。</p>
<p>在<code>electron-vue</code>里内置了<code>vue-electron</code>这个模块，可以在<code>vue</code>里很方便的使用诸如<code>this.$electron.remote.xxx</code>来使用<code>remote</code>的模块。</p>
<h5 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h5><p><code>shell</code>模块的官方说明是：<code>Manage files and URLs using their default applications.</code>也就是使用文件或者<code>URL</code>的默认应用。通常我们可以用其让默认图片应用打开一张图片、让默认浏览器打开一个<code>url</code>。</p>
<p>如果我们想在<code>renderer</code>进程里点击一个按钮然后在默认浏览器里打开一个<code>url</code>的话就可以这样：</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>openURL<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
    methods<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token function">openURL</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$electron<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>shell<span class="token punctuation">.</span><span class="token function">openExternal</span><span class="token punctuation">(</span><span class="token string">'https://github.com/Molunerfinn/PicGo'</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre>

<p>更多请查看<a target="_blank" rel="noopener" href="https://electronjs.org/docs/api/shell">文档</a></p>
<h5 id="dialog"><a href="#dialog" class="headerlink" title="dialog"></a>dialog</h5><p>有的时候我们会有打开原生的对话框的需求，比如软件说明啥的</p>
<pre class="language-js" data-language="js"><code class="language-js">s
<span class="token function">openDialog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$electron<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>dialog<span class="token punctuation">.</span><span class="token function">showMessageBox</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    title<span class="token operator">:</span> <span class="token string">'PicGo'</span><span class="token punctuation">,</span>
    message<span class="token operator">:</span> <span class="token string">'PicGo'</span><span class="token punctuation">,</span>
    detail<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Version: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>pkg<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">\nAuthor: Molunerfinn\nGithub: https://github.com/Molunerfinn/PicGo</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>更多请查看<a target="_blank" rel="noopener" href="https://electronjs.org/docs/api/dialog">文档</a></p>
<h4 id="Menu-amp-Browser-Window的应用"><a href="#Menu-amp-Browser-Window的应用" class="headerlink" title="Menu &amp; Browser-Window的应用"></a>Menu &amp; Browser-Window的应用</h4><p>使用<code>Menu</code>可能很多人能够理解。但是为什么要使用<code>BrowserWindow</code>呢？因为需要定位你打开<code>Menu</code>的窗口。</p>
<p>在<code>PicGo</code>里，有一个点击按钮打开<code>Menu</code>的操作，大致如下：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token function">buildMenu</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>menu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token function">openDialog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>menu<span class="token punctuation">.</span><span class="token function">popup</span><span class="token punctuation">(</span>remote<span class="token punctuation">.</span>getCurrentWindow<span class="token punctuation">)</span> <span class="token comment">// 获取当前打开Menu的窗口</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p>这里的<code>menu.popup</code>就需要你指定一下打开这个<code>menu</code>的窗口。它将自动定位你点击的位置而弹出。</p>
<h4 id="Main-amp-Renderer通信"><a href="#Main-amp-Renderer通信" class="headerlink" title="Main &amp; Renderer通信"></a>Main &amp; Renderer通信</h4><h5 id="ipcMain-amp-ipcRenderer"><a href="#ipcMain-amp-ipcRenderer" class="headerlink" title="ipcMain &amp; ipcRenderer"></a>ipcMain &amp; ipcRenderer</h5><p>在<code>Vue</code>里，如果是非父子组件通信，很常用的是通过<code>Bus Event</code>来实现的。而electron里的不同进程间的通信其实也很类似，是通过<code>ipcMain</code>和<code>ipcRenderer</code>来实现的。其中<code>ipcMain</code>是在<code>main</code>进程里使用的，而<code>ipcRenderer</code>是在<code>renderer</code>进程里使用的。</p>
<p>官网的例子简洁明了</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// In main process.</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span>ipcMain<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'asynchronous-message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>  <span class="token comment">// prints "ping"</span>
  event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'asynchronous-reply'</span><span class="token punctuation">,</span> <span class="token string">'pong'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'synchronous-message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>  <span class="token comment">// prints "ping"</span>
  event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token string">'pong'</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// In renderer process (web page).</span>
<span class="token keyword">const</span> <span class="token punctuation">&#123;</span>ipcRenderer<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ipcRenderer<span class="token punctuation">.</span><span class="token function">sendSync</span><span class="token punctuation">(</span><span class="token string">'synchronous-message'</span><span class="token punctuation">,</span> <span class="token string">'ping'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// prints "pong"</span>

ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'asynchronous-reply'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token comment">// prints "pong"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'asynchronous-message'</span><span class="token punctuation">,</span> <span class="token string">'ping'</span><span class="token punctuation">)</span></code></pre>

<p>其中<code>ipcMain</code>只有监听来自<code>ipcRenderer</code>的某个事件后才能返回给<code>ipcRenderer</code>值。而<code>ipcRenderer</code>既可以收，也可以发。</p>
<p>那么问题就来了，如何让<code>ipcMain</code>主动发送消息呢？或者说让<code>Main进程</code>主动发送消息给<code>ipcRenderer</code>。</p>
<p>首先要明确的是，<code>ipcMain</code>无法主动发消息给<code>ipcRenderer</code>。因为<code>ipcMain</code>只有<code>.on()</code>方法没有<code>.send()</code>的方法。所以只能用其他方法来实现。有办法么？有的，用<code>webContents</code>。</p>
<h5 id="webContents"><a href="#webContents" class="headerlink" title="webContents"></a>webContents</h5><p><code>webContents</code>其实是<code>BrowserWindow</code>实例的一个属性。也就是如果我们需要在<code>Main进程</code>里给某个窗口某个页面发送消息，则必须通过<code>win.webContents.send()</code>方法来发送。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// In main process</span>
<span class="token keyword">let</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'img-files'</span><span class="token punctuation">,</span> imgs<span class="token punctuation">)</span></code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// In renderer process</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'img-files'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">Buye me a cup of coffee or ice coke.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://blog.res.jianchengwang.info/alipay.PNG"><img loading="lazy" src="https://blog.res.jianchengwang.info/alipay.PNG" alt="Alipay" title="Alipay"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://blog.res.jianchengwang.info/wxpay.PNG"><img loading="lazy" src="https://blog.res.jianchengwang.info/wxpay.PNG" alt="WechatPay" title="WechatPay"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>jiancheng_wang</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://jianchengwang.info/2020/10/27/web/vue/electron-vue/" title="electron-vue">https://jianchengwang.info/2020/10/27/web/vue/electron-vue/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless stating additionally.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/10/27/web/js/this-in-javascript/" rel="prev" title="JS中的this机制"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">JS中的this机制</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/10/27/web/js/functional-programming-in-javascript/" rel="next" title="Functional Programming in JavaScript"><span class="post-nav-text">Functional Programming in JavaScript</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div id="comment"><div class="comment-tooltip text-center"><span>点击按钮跳转 GitHub Issues 评论。</span><br><span>若没有本文 Issue，您可以使用 Comment 模版新建。</span><br><a class="hty-button hty-button--raised" id="github-issues" target="_blank" rel="noopener" href="https://github.com/jianchenwang/jianchengwang.github.io/issues?q=is:issue+electron-vue">GitHub Issues</a></div></div></main><footer class="sidebar-translate" id="footer"><div class="beian"><a rel="noopener" href="https://beian.miit.gov.cn/" target="_blank">闽ICP备16000680号</a></div><div class="copyright"><span>&copy; 2020 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> jiancheng_wang</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.2.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.2.0</span></div><div class="footer-custom-text"><a style="display:inline-block" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="blank" title="又拍云"><img height="30" src="https://blog.res.jianchengwang.info/upyun-logo.png" alt="upyun"/></a></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div><script defer src="/js/utils.js"></script><script defer src="/js/hexo-theme-yun.js"></script><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-widget-tree@0.0.5/js/index.js"></script><div id="widget-tree">
      <ul><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/java/">java</a><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/java/javase/">javase</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/25/java/javase/java8/" title="java8"><i class="post-icon gg-file-document"></i>java8</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/java/middleware/">middleware</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/java/middleware/canal/" title="canal"><i class="post-icon gg-file-document"></i>canal</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/java/middleware/nacos/" title="nacos"><i class="post-icon gg-file-document"></i>nacos</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/03/java/middleware/flink/" title="flink"><i class="post-icon gg-file-document"></i>flink</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/java/tool/">tool</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/java/tool/Gradle/" title="gradle"><i class="post-icon gg-file-document"></i>gradle</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/linux/">linux</a><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/linux/dist/">dist</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/01/linux/dist/debian/" title="debian"><i class="post-icon gg-file-document"></i>debian</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/linux/dist/manjaro/" title="manjaro"><i class="post-icon gg-file-document"></i>manjaro</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/linux/dist/centos7/" title="centos7"><i class="post-icon gg-file-document"></i>centos7</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/linux/sh/">sh</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/linux/sh/curl/" title="curl"><i class="post-icon gg-file-document"></i>curl</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/linux/sh/tlcl/" title="tlcl"><i class="post-icon gg-file-document"></i>tlcl</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/linux/soft/">soft</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/13/linux/soft/docker/" title="docker"><i class="post-icon gg-file-document"></i>docker</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/25/linux/soft/git/" title="git"><i class="post-icon gg-file-document"></i>git</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/linux/ssh/">ssh</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/linux/sh/ssh/" title="ssh"><i class="post-icon gg-file-document"></i>ssh</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/play/">play</a><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/play/gfw/">gfw</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/play/gfw/vps/" title="vps"><i class="post-icon gg-file-document"></i>vps</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/python/">python</a><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/python/da/">da</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/11/python/da/pandas/" title="pandas"><i class="post-icon gg-file-document"></i>pandas</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/python/web/">web</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/20/python/web/flask-todolist/" title="flask-todolist"><i class="post-icon gg-file-document"></i>flask-todolist</a></li></ul></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/store/">store</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/store/%E6%96%AD%E5%88%80%E6%AE%8B%E9%9B%AA/" title="断刀残雪"><i class="post-icon gg-file-document"></i>断刀残雪</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/store/%E9%95%BF%E5%AE%89%E4%B9%B1/" title="长安乱"><i class="post-icon gg-file-document"></i>长安乱</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/store/%E6%98%8E%E6%9C%88%E6%B3%AA/" title="明月泪"><i class="post-icon gg-file-document"></i>明月泪</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/store/%E6%B8%A9%E6%9F%94%E5%88%80/" title="温柔刀"><i class="post-icon gg-file-document"></i>温柔刀</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/store/%E5%A4%A7%E8%8D%92/" title="大荒"><i class="post-icon gg-file-document"></i>大荒</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/web/">web</a><ul class="tree-list-children"><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/web/css/">css</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/12/web/css/web-design-in-4-minutes/" title="web-design-in-4-minutes"><i class="post-icon gg-file-document"></i>web-design-in-4-minutes</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/web/js/">js</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/web/js/functional-programming-in-javascript/" title="Functional Programming in JavaScript"><i class="post-icon gg-file-document"></i>Functional Programming in JavaScript</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/24/web/js/keep-async-await-from-blocking-execution/" title="keep-async-await-from-blocking-execution"><i class="post-icon gg-file-document"></i>keep-async-await-from-blocking-execution</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/web/js/this-in-javascript/" title="JS中的this机制"><i class="post-icon gg-file-document"></i>JS中的this机制</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/web/js/es6/" title="es6"><i class="post-icon gg-file-document"></i>es6</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/web/live2d/">live2d</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/25/web/live2d/live2d-web/" title="live2d-web"><i class="post-icon gg-file-document"></i>live2d-web</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/web/serverless/">serverless</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/25/web/serverless/intro-to-serverless-functions/" title="intro to serverless functions"><i class="post-icon gg-file-document"></i>intro to serverless functions</a></li></ul></li><li class="tree-list-item"><i class="toggle-post-icon gg-folder-add"></i><a class="tree-list-link" href="/categories/web/vue/">vue</a><ul class="tree-list-children"><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/10/27/web/vue/electron-vue/" title="electron-vue"><i class="post-icon gg-file-document"></i>electron-vue</a></li><li class="tree-list-item"><a class="tree-list-post-link" href="/2020/11/25/web/vue/intro-to-vue/" title="intro to vue"><i class="post-icon gg-file-document"></i>intro to vue</a></li></ul></li></ul></li></ul>
        <div id="widget-tree-button">
          <i class="gg-chevron-right"></i>
        </div>
      </div><!-- hexo injector body_end end --></body></html>